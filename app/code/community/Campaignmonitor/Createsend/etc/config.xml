<?xml version="1.0"?>
<!--
/**
* Campaign Monitor Magento Extension
*
* NOTICE OF LICENSE
*
* This source file is subject to the Open Software License (OSL 3.0)
* that is available through the world-wide-web at this URL:
* http://opensource.org/licenses/osl-3.0.php
* If you are unable to obtain it through the world-wide-web, please
* send an email to license@magento.com and you will be sent a copy.
*
* @package Campaignmonitor_Createsend
* @copyright Copyright (c) 2015 Campaign Monitor (https://www.campaignmonitor.com/)
* @license http://opensource.org/licenses/osl-3.0.php Open Software License (OSL 3.0)
*/
-->
<config>
    <modules>
        <Campaignmonitor_Createsend>
            <version>1.0.3</version>
        </Campaignmonitor_Createsend>
    </modules>
    <adminhtml>
        <layout>
            <updates>
                <campaignmonitor_createsend>
                    <file>campaignmonitor/createsend.xml</file>
                </campaignmonitor_createsend>
            </updates>
        </layout>
        <acl>
            <resources>
                <admin>
                    <children>
                        <system>
                            <children>
                                <config>
                                    <children>
                                        <createsend_general>
                                            <title>Campaign Monitor General Section</title>
                                        </createsend_general>
                                        <createsend_customers>
                                            <title>Campaign Monitor Customers Section</title>
                                        </createsend_customers>
                                        <createsend_transactional>
                                            <title>Campaign Monitor Transactional Section</title>
                                        </createsend_transactional>
                                    </children>
                                </config>
                            </children>
                        </system>
                    </children>
                </admin>
            </resources>
        </acl>
        <events>
            <controller_action_layout_generate_blocks_after>
                <observers>
                    <campaignmonitor_createsend_addjs>
                        <type>singleton</type>
                        <class>createsend/config_api</class>
                        <method>addJavascriptBlock</method>
                    </campaignmonitor_createsend_addjs>
                </observers>
            </controller_action_layout_generate_blocks_after>
        </events>
    </adminhtml>
    <global>
        <models>
            <createsend>
                <class>Campaignmonitor_Createsend_Model</class>
                <resourceModel>createsend_resource</resourceModel>
            </createsend>
            <createsend_resource>
                <class>Campaignmonitor_Createsend_Model_Resource</class>
                <entities>
                    <email>
                        <table>campaignmonitor_createsend_email</table>
                    </email>
                </entities>
            </createsend_resource>
            <core>
                <rewrite>
                    <email_template>Campaignmonitor_Createsend_Model_Email_Template</email_template>
                </rewrite>
            </core>
        </models>
        <resources>
            <campaignmonitor_createsend_setup>
                <setup>
                    <module>Campaignmonitor_Createsend</module>
                </setup>
                <connection>
                    <use>core_setup</use>
                </connection>
            </campaignmonitor_createsend_setup>
        </resources>
        <helpers>
            <createsend>
                <class>Campaignmonitor_Createsend_Helper</class>
            </createsend>
        </helpers>
        <blocks>
            <createsend>
                <class>Campaignmonitor_Createsend_Block</class>
            </createsend>
        </blocks>
        <events>
            <customer_save_before>
                <observers>
                    <campaignmonitor_createsend_check_subscription_status>
                        <type>singleton</type>
                        <class>createsend/customer_observer</class>
                        <method>checkSubscriptionStatus</method>
                    </campaignmonitor_createsend_check_subscription_status>
                </observers>
            </customer_save_before>
            <customer_delete_before>
                <observers>
                    <campaignmonitor_createsend_customer_deleted>
                        <type>singleton</type>
                        <class>createsend/customer_observer</class>
                        <method>customerDeleted</method>
                    </campaignmonitor_createsend_customer_deleted>
                </observers>
            </customer_delete_before>
            <sales_order_save_after>
                <observers>
                    <campaignmonitor_createsend_check_subscription_status>
                        <type>singleton</type>
                        <class>createsend/customer_observer</class>
                        <method>checkSubscriptionStatus</method>
                    </campaignmonitor_createsend_check_subscription_status>
                </observers>
            </sales_order_save_after>
            <wishlist_product_add_after>
                <observers>
                    <campaignmonitor_createsend_check_subscription_status>
                        <type>singleton</type>
                        <class>createsend/customer_observer</class>
                        <method>checkSubscriptionStatus</method>
                    </campaignmonitor_createsend_check_subscription_status>
                </observers>
            </wishlist_product_add_after>
            <admin_system_config_changed_section_createsend_general>
                <observers>
                    <campaignmonitor_createsend_update_webhook>
                        <type>singleton</type>
                        <class>createsend/api_observer</class>
                        <method>checkConfig</method>
                    </campaignmonitor_createsend_update_webhook>
                </observers>
            </admin_system_config_changed_section_createsend_general>
            <admin_system_config_changed_section_createsend_customers>
                <observers>
                    <campaignmonitor_createsend_create_custom_fields>
                        <type>singleton</type>
                        <class>createsend/customer_observer</class>
                        <method>createCustomFields</method>
                    </campaignmonitor_createsend_create_custom_fields>
                </observers>
            </admin_system_config_changed_section_createsend_customers>
            <controller_action_predispatch_adminhtml_newsletter_subscriber_massUnsubscribe>
                <observers>
                    <campaignmonitor_createsend_update_user_massaction>
                        <type>singleton</type>
                        <class>createsend/api_observer</class>
                        <method>massUnsubscribeUsers</method>
                    </campaignmonitor_createsend_update_user_massaction>
                </observers>
            </controller_action_predispatch_adminhtml_newsletter_subscriber_massUnsubscribe>
            <controller_action_predispatch_adminhtml_newsletter_subscriber_massDelete>
                <observers>
                    <campaignmonitor_createsend_update_user_massaction>
                        <type>singleton</type>
                        <class>createsend/api_observer</class>
                        <method>massUnsubscribeUsers</method>
                    </campaignmonitor_createsend_update_user_massaction>
                </observers>
            </controller_action_predispatch_adminhtml_newsletter_subscriber_massDelete>
            <controller_action_predispatch_newsletter_subscriber_new>
                <observers>
                    <campaignmonitor_createsend_subscribe_new_user>
                        <type>singleton</type>
                        <class>createsend/api_observer</class>
                        <method>subscribeNewUser</method>
                    </campaignmonitor_createsend_subscribe_new_user>
                </observers>
            </controller_action_predispatch_newsletter_subscriber_new>
            <!-- Bug fix for Magento newsletter's change_status_at field non-update bug. -->
            <newsletter_subscriber_save_before>
                <observers>
                    <campaignmonitor_createsend_newsletter_change_status_update>
                        <type>singleton</type>
                        <class>createsend/newsletter_observer</class>
                        <method>setChangeStatusAt</method>
                    </campaignmonitor_createsend_newsletter_change_status_update>
                </observers>
            </newsletter_subscriber_save_before>
            <catalog_product_save_after>
                <observers>
                    <campaignmonitor_createsend_product_update>
                        <type>singleton</type>
                        <class>createsend/product_observer</class>
                        <method>updateWishlistFields</method>
                    </campaignmonitor_createsend_product_update>
                </observers>
            </catalog_product_save_after>
        </events>
    </global>
    <admin>
        <routers>
            <adminhtml>
                <args>
                    <modules>
                        <Campaignmonitor_Createsend before="Mage_Adminhtml">Campaignmonitor_Createsend_Adminhtml</Campaignmonitor_Createsend>
                    </modules>
                </args>
            </adminhtml>
        </routers>
    </admin>
    <frontend>
        <routers>
            <createsend>
                <use>standard</use>
                <args>
                    <module>Campaignmonitor_Createsend</module>
                    <frontName>createsend</frontName>
                </args>
            </createsend>
        </routers>
    </frontend>
    <default>
        <createsend_general>
            <api>
                <authentication_method>api_key</authentication_method>
            </api>
            <advanced>
                <logging>1</logging>
                <webhook_enabled>1</webhook_enabled>
                <subscriber_synchronisation_enabled>1</subscriber_synchronisation_enabled>
                <subscriber_synchronisation_resolution_method>timestamp</subscriber_synchronisation_resolution_method>
                <magento_cron_enabled>1</magento_cron_enabled>
            </advanced>
        </createsend_general>
        <createsend_customers>
            <attributes>
                <m_to_cm_attributes>a:19:{i:0;a:1:{s:7:"magento";s:18:"FONTIS-has-account";}i:1;a:1:{s:7:"magento";s:10:"created_in";}i:2;a:1:{s:7:"magento";s:8:"group_id";}i:3;a:1:{s:7:"magento";s:10:"created_at";}i:4;a:1:{s:7:"magento";s:9:"firstname";}i:5;a:1:{s:7:"magento";s:8:"lastname";}i:6;a:1:{s:7:"magento";s:3:"dob";}i:7;a:1:{s:7:"magento";s:6:"gender";}i:8;a:1:{s:7:"magento";s:12:"confirmation";}i:9;a:1:{s:7:"magento";s:10:"website_id";}i:10;a:1:{s:7:"magento";s:8:"store_id";}i:11;a:1:{s:7:"magento";s:32:"FONTIS-sales-average-order-value";}i:12;a:1:{s:7:"magento";s:29:"FONTIS-sales-first-order-date";}i:13;a:1:{s:7:"magento";s:29:"FONTIS-sales-last-order-value";}i:14;a:1:{s:7:"magento";s:28:"FONTIS-sales-last-order-date";}i:15;a:1:{s:7:"magento";s:30:"FONTIS-sales-total-order-value";}i:16;a:1:{s:7:"magento";s:35:"FONTIS-sales-total-number-of-orders";}i:17;a:1:{s:7:"magento";s:45:"FONTIS-sales-total-number-of-products-ordered";}i:18;a:1:{s:7:"magento";s:31:"FONTIS-number-of-wishlist-items";}}</m_to_cm_attributes>
            </attributes>
            <wishlists>
                <max_wishlist_items>1</max_wishlist_items>
                <wishlist_product_attributes>a:4:{i:0;a:1:{s:7:"magento";s:4:"name";}i:1;a:1:{s:7:"magento";s:5:"price";}i:2;a:1:{s:7:"magento";s:17:"short_description";}i:3;a:1:{s:7:"magento";s:3:"sku";}}</wishlist_product_attributes>
            </wishlists>
        </createsend_customers>
        <createsend_transactional>
            <emails>
                <transactional_email_enabled>0</transactional_email_enabled>
                <transactional_email_retention_days>90</transactional_email_retention_days>
            </emails>
        </createsend_transactional>
    </default>
    <crontab>
        <jobs>
            <campaignmonitor_createsend_subscriber_synchronise_initial>
                <schedule>
                    <cron_expr>*/5 * * * *</cron_expr>
                </schedule>
                <run>
                    <model>createsend/list_initial_cron::runFromMagentoCron</model>
                </run>
            </campaignmonitor_createsend_subscriber_synchronise_initial>
            <campaignmonitor_createsend_subscriber_synchronise>
                <schedule>
                    <cron_expr>0 1 * * *</cron_expr>
                </schedule>
                <run>
                    <model>createsend/list_cron::runFromMagentoCron</model>
                </run>
            </campaignmonitor_createsend_subscriber_synchronise>
            <campaignmonitor_createsend_email_download>
                <schedule>
                    <cron_expr>0 * * * *</cron_expr>
                </schedule>
                <run>
                    <model>createsend/email_cron::runFromMagentoCron</model>
                </run>
            </campaignmonitor_createsend_email_download>
        </jobs>
    </crontab>
</config>
